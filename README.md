
### Краткий обзор
Данный проект реализует систему обнаружения логотипа Т-Банк на изображениях. Модель обучения распознаёт область с логотипом банка и возвращает её координаты. Решение упаковано в Docker-контейнер и развёрнуто как REST API-сервис на порту 8000. По запросу на эндпоинт `/detect` сервис принимает изображение и возвращает JSON-ответ со списком найденных прямоугольных областей и меток объектов.

---
### Структура репозитория

`Docekrfile` - описывает сборку Docker-контейнера с сервисом.

`example_data.yaml` - пример конфига для обучения модели

`requirements.txt` - список зависимостей Python. 

`batch_detect.py` - фильтрация изображений  наличию логотипов. При обнаружении 

переносит изображения в отдельную папку. После обработки изображений выводит статистику обработки.

`validate.py` - проверяет точность модели на тестовом наборе валидационных данных и выводит метрики precision, recall, mAP, f1-score IoU=0.5.

`README.md` - файл документации к проекту

`app/main.py` - код FastAPI-приложения для интерфейса модели.

`app/models.py` - описание структур данных для API детекции логотипов.

`app/utils.py` - обработка формата входящих изображений и преобразование их в RGB-объект `PIL.Image` для дальнейшей обработки.

`app/detector.py` - работа с YOLOv8 моделью, обнаружение логотипов. Возвращает результат в формате объектов `Pydantic`: `Detection` и `BoundingBox`

`app/weights/best.pt` - обученная YOLOv8 модель.

---

### Подход к решению

1. Собрал датасет из 400 изоюражений, содержащих логотип Т-Банка
	* Изображения собирались из предложенного датасета `data-sirius` и 20 измененных изображений из интернета для разнообразия.
2. Разметил каждое изображение, выделив на каждом логотип
	* Разметка производилась при помощи инструмента LabelImg
	
3. Обучил модель используя `PyTorch`с применением архитектуры `YOLOv8`.
	* Выбрал именно её из-за имеющегося у меня опыта работы с ней, простоты обучения. Это помогло достичь максимальной точности при оптимальных затратах ресурсов

4. Создание `REST-API` сервиса с эндпоинтом `/detect`  

	* Пользователь отправляет `POST`-запрос, сервис возвращает список найденных логотипов с координатами в `JSON`-формате.  
	* Запрос отправляется через `curl`.  
	
	Пример `curl`-запроса:
	
	```bash
	curl -X 'POST' \
	  'http://localhost:8000/detect' \
	  -H 'accept: application/json' \
	  -H 'Content-Type: multipart/form-data' \
	  -F 'files=@0example.jpeg;type=image/jpeg'
	```
	- `curl` — утилита для отправки `HTTP`-запросов  
	- `-X POST` — указываем метод `HTTP`-запроса. Используем `POST`, потому что мы отправляем данные на сервер  
	- `http://localhost:8000` — адрес локального сервера, работающего на порту `8000`  
	- `/detect` — эндпоинт, к которому мы обращаемся для детекции  
	- `-H` — сообщаем серверу, что хотим получить данные в `json`-формате  
	- `-F` — говорит `curl`, что мы отправляем поле формы `form-data`  
	- `files=@<name>.jpeg;type=image/jpeg` — указываем путь к файлу и говорим `curl` о необходимости взять файл с диска  
	  - `type=image/jpeg` — явное указание MIME-типа файла (формат изображения)

5.  Отладка и тестирование. Самый сложный этап.
	* Написаны `validate.py` и `batch_detect.py` - программы для валидации и проверки точности модели.  Но даже с ними приходилось вручную просматривать результаты, проверять отрисованные рамки и анализировать ошибки. Это очень долгий процесс.
	* Мне удалось достичь точности в 86 процентов.
	* Работа с обученной моделью - работа с черным ящиком. Сложно понять где конкретно находится ошибка. Она может быть в постобработке, входных данных или самой модели. 
	* Приходилось несколько раз переписывать `app/detector.py` потому что он неправильно возвращал данные. Перестраивать логику `app/utils.py` чтобы модель получала правильный формат картинки и тратила меньше времени и ресурсов на обработку. 
	* Работа с метриками качества обучения модели, имея опыт работы с ними, остается сложной для меня. 
6. Упаковка в `Docker`.

---
### Пособие по контакту с проектом

1. Клонирование репозитория
   ```bash 
	git clone https://github.com/boomchik93/tbank-logo-detector.git
	cd tbank-logo-detector   
	```


2. Сборка образа
 ```bash
   docker build -t tbank-logo-detector .
   ```

3. Запуск образа 
```bash
docker run -d -p 8000:8000 --name tbank-logo-detector tbank-logo-detector
```

4. После запуска API будет доступно по адресу: `http://localhost:8000/detect`

Пример запроса:
```bash
curl -X 'POST' \
  'http://localhost:8000/detect' \
  -H 'accept: application/json' \
  -H 'Content-Type: multipart/form-data' \
  -F 'file=@example.jpg;type=image/jpeg'
```

Ответ будет приходить в формате:
```bash
[
  {"x": 120, "y": 80, "width": 60, "height": 60, "confidence": 0.95}
]
```

---

### Результаты метрик
```bash
mAP@0.5: 0.936
mAP@[0.5:0.95]: 0.691
mAP@0.75: 0.790
F1-score @ IoU=0.5: 0.860
```

